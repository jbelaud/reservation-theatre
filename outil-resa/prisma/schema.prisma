// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

// ⚡ PostgreSQL/Neon - Base de données de production
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Association {
  id              String   @id @default(cuid())
  nom             String
  slug            String   @unique
  email           String   @unique
  password        String
  telephone       String?
  
  // Licence
  licenceActive   Boolean  @default(true)  // true pour MVP (gratuit)
  licenceExpire   DateTime?
  
  // Customisation
  logo            String?
  affiche         String?
  couleurTheme    String   @default("#1e40af")
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  representations Representation[]
  plansSalle      PlanSalle[]
  paiements       Paiement[]
}

model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  nom       String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PlanSalle {
  id            String @id @default(cuid())
  nom           String @default("Salle principale")
  capaciteTotal Int    @default(100)
  structure     String // JSON stocké en String pour SQLite
  configuration String @default("standard") // "standard" ou "french"
  
  associationId String @unique  // Une asso = un plan pour MVP
  association   Association @relation(fields: [associationId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Representation {
  id          String   @id @default(cuid())
  titre       String   @default("Représentation")
  date        DateTime
  heure       String
  capacite    Int
  description String?
  
  placesOccupees String   @default("[]") // JSON en String pour SQLite
  placesPmr      String   @default("[]") // JSON en String pour SQLite
  structure      String?  // JSON stocké en String (override du plan global)
  statut         String   @default("planifie")
  
  associationId  String
  association    Association @relation(fields: [associationId], references: [id], onDelete: Cascade)
  reservations   Reservation[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Reservation {
  id          String   @id @default(cuid())
  prenom      String
  nom         String
  telephone   String
  email       String?
  nbPlaces    Int
  sieges      String   // JSON en String pour SQLite
  statut      String   @default("confirmé")
  notes       String?
  
  representationId String
  representation   Representation @relation(fields: [representationId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Paiement {
  id            String   @id @default(cuid())
  montant       Float    @default(299)
  datePaiement  DateTime @default(now())
  anneeCouverte Int      // Ex: 2026
  notes         String?
  
  associationId String
  association   Association @relation(fields: [associationId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime @default(now())
}
